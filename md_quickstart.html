<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>CUSP: Quick Start Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript">
     var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
     document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
     try {
       var pageTracker = _gat._getTracker("UA-34296872-1");
       pageTracker._trackPageview();
     } catch(err) {}
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="45">
 <tbody>
 <tr style="height: 56px;">
  <!-- <td id="projectlogo"><img alt="Logo" src="cusp_logo.png"/></td> -->
  <td style="padding-left: 0.5em;">
   <!-- <div id="projectname">CUSP -->
   <div id="menubar">&nbsp;</div>
   <a href="http://github.com/cusplibrary/cusplibrary">
    <img style="position: absolute; top: 0; right: 0; border: 0;"
         src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
         alt="Fork me on GitHub">
   </a>
<ul id="menu">
      <li><a href="/"><img src="cusp_logo.png" alt="CUSP" height=80px title="CUSP"/></a></li>
      <!-- <li><a title="Quick Start Guide" href="http://github.com/cusplibrary/cusplibrary/wiki/Quick-Start-Guide">Get Started</a></li> -->
      <li><a title="Quick Start Guide" href="md_quickstart.html">Get Started</a></li>
      <li><a title="Examples" href="examples.html">Examples</a></li>
      <li><a title="Join the cusp-users mailing list" href="http://groups.google.com/group/cusp-users">Mailing List</a></li>
      <li><a title="Download latest Cusp source code" href="https://github.com/cusplibrary/cusplibrary/archive/v0.4.0.zip">Get Cusp</a></li>
</ul>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Quick Start Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Summary Guide for new Cusp developers</h1>
<h2>Introduction</h2>
<p>This page describes how to develop CUDA applications with CUSP, a C++ template library for sparse matrix computations. This guide is intended to be accessible, even to developers with limited C++ experience.</p>
<h2>Prerequisites</h2>
<p><a href="https://github.com/cusplibrary/cusplibrary/archive/v0.4.0.zip">Cusp v0.4.0</a> requires <a href="http://www.nvidia.com/object/cuda_get.html">CUDA 5.5 (or newer)</a>. You can check the CUDA installation by using nvcc on the command line as follows :</p>
<div class="fragment"><div class="line">$ nvcc --version</div>
<div class="line">nvcc: NVIDIA (R) Cuda compiler driver</div>
<div class="line">Copyright (c) 2005-2014 NVIDIA Corporation</div>
<div class="line">Built on Thu_Jul_17_21:41:27_CDT_2014</div>
<div class="line">Cuda compilation tools, release 6.5, V6.5.12</div>
</div><!-- fragment --><p>Since Cusp is a C++ template library there is nothing to "build". Simply download the newest version of Cusp from <a href="https://github.com/cusplibrary/cusplibrary/releases">here</a> and extract the contents of each zip file to a directory. We suggest installing Cusp to the CUDA <code>include</code> directory, which is usually</p>
<ul>
<li><code>/usr/local/cuda/include/</code> on a Linux and Mac OSX</li>
<li><code>C:\CUDA\include\</code> on a Windows system</li>
</ul>
<h2>Simple Example</h2>
<p>Let's compile a simple program to make sure all the prerequisites are satisfied. Save the following source code to a file named <code>version.cu</code>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;thrust/version.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cusp/version.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> cuda_major =  CUDA_VERSION / 1000;</div>
<div class="line">    <span class="keywordtype">int</span> cuda_minor = (CUDA_VERSION % 1000) / 10;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> thrust_major = THRUST_MAJOR_VERSION;</div>
<div class="line">    <span class="keywordtype">int</span> thrust_minor = THRUST_MINOR_VERSION;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> cusp_major = CUSP_MAJOR_VERSION;</div>
<div class="line">    <span class="keywordtype">int</span> cusp_minor = CUSP_MINOR_VERSION;</div>
<div class="line"></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;CUDA   v&quot;</span> &lt;&lt; cuda_major   &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; cuda_minor   &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Thrust v&quot;</span> &lt;&lt; thrust_major &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; thrust_minor &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Cusp   v&quot;</span> &lt;&lt; cusp_major   &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; cusp_minor   &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Now compile <code>version.cu</code> with <code>nvcc</code>. If Cusp was installed to the CUDA <code>include</code> directory then the following commands should work.</p>
<div class="fragment"><div class="line">$ nvcc version.cu -o version</div>
<div class="line">$ ls</div>
<div class="line">thrust  version version.cu</div>
<div class="line">$ ./version</div>
<div class="line">CUDA   v6.5</div>
<div class="line">Thrust v1.7</div>
<div class="line">Cusp   v0.4</div>
</div><!-- fragment --><h2>Other Examples</h2>
<p>Additional Cusp examples are available for <a href="http://github.com/cusplibrary/cusplibrary/tree/master/examples">download</a> or <a href="examples.html">online browsing</a>. These examples can be compiled using the same procedure as above. For instance, the Conjugate Gradient solver example is compiled and run as follows:</p>
<div class="fragment"><div class="line">$ cd examples/Solvers/</div>
<div class="line">$ nvcc -O2 <a class="code" href="group__krylov__methods.html#ga6aa97799b77e1de21fc88be236c6e4a8">cg</a>.cu -o <a class="code" href="group__krylov__methods.html#ga6aa97799b77e1de21fc88be236c6e4a8">cg</a></div>
<div class="line">$ ./<a class="code" href="group__krylov__methods.html#ga6aa97799b77e1de21fc88be236c6e4a8">cg</a></div>
<div class="line">Solver will <span class="keywordflow">continue</span> until residual norm 0.01 or reaching 100 iterations</div>
<div class="line">Iteration Number  | Residual Norm</div>
<div class="line">            0       1.000000e+01</div>
<div class="line">            1       1.414214e+01</div>
<div class="line">            2       1.093707e+01</div>
<div class="line">            3       8.949319e+00</div>
<div class="line">            4       6.190055e+00</div>
<div class="line">            5       3.835189e+00</div>
<div class="line">            6       1.745481e+00</div>
<div class="line">            7       5.963546e-01</div>
<div class="line">            8       2.371134e-01</div>
<div class="line">            9       1.152524e-01</div>
<div class="line">           10       3.134467e-02</div>
<div class="line">           11       1.144415e-02</div>
<div class="line">           12       1.824176e-03</div>
<div class="line">Successfully converged after 12 iterations.</div>
</div><!-- fragment --><h2>Sparse Matrices</h2>
<p>Cusp natively supports several sparse matrix formats:</p>
<ul>
<li><a href="classcusp_1_1coo__matrix.html">Coordinate (COO)</a></li>
<li><a href="classcusp_1_1csr__matrix.html">Compressed Sparse Row (CSR)</a></li>
<li><a href="classcusp_1_1dia__matrix.html">Diagonal (DIA)</a></li>
<li><a href="classcusp_1_1ell__matrix.html">ELL (ELL)</a></li>
<li><a href="classcusp_1_1hyb__matrix.html">Hybrid (HYB)</a></li>
<li><a href="classcusp_1_1permutation__matrix.html">Permutation</a></li>
</ul>
<p>When manipulating matrices it's important to understand the advantages and disadvantages of each format. Broadly speaking, the DIA and ELL formats are the most efficient for computing sparse matrix-vector products, and therefore are the fastest formats for solving sparse linear systems with iterative methods (e.g. Conjugate Gradients). The COO and CSR formats are more flexible than DIA and ELL and easier manipulate. The HYB format is a hybrid combination of the ELL (fast) and COO (flexible) formats and is a good default choice. Refer to the matrix format <a href="examples.html">examples</a> for additional information.</p>
<h2>Format Conversions</h2>
<p>Cusp makes it easy to transfer data between the host and device and convert between sparse matrix formats. For example,</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="csr__matrix_8h.html">cusp/csr_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="hyb__matrix_8h.html">cusp/hyb_matrix.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Allocate storage for a 5 by 8 sparse matrix in CSR format with 12</span></div>
<div class="line">  <span class="comment">// nonzero entries on the host</span></div>
<div class="line">  <a class="code" href="classcusp_1_1csr__matrix.html">cusp::csr_matrix&lt;int,float,cusp::host_memory&gt;</a> csr_host(5,8,12);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Transfer the matrix to the device</span></div>
<div class="line">  <a class="code" href="classcusp_1_1csr__matrix.html">cusp::csr_matrix&lt;int,float,cusp::device_memory&gt;</a> csr_device(csr_host);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Convert the matrix to HYB format on the device</span></div>
<div class="line">  <a class="code" href="classcusp_1_1hyb__matrix.html">cusp::hyb_matrix&lt;int,float,cusp::device_memory&gt;</a> csr_device(csr_device);</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Iterative Solvers</h2>
<p>Cusp provides a variety of <a href="http://en.wikipedia.org/wiki/Iterative_method">iterative methods</a> for solving sparse linear systems. Established <a href="http://en.wikipedia.org/wiki/Krylov_subspace">Krylov subspace</a> methods are available:</p>
<ul>
<li><a href="group__krylov__methods.html#ga6aa97799b77e1de21fc88be236c6e4a8">Conjugate-Gradient(CG)</a></li>
<li><a href="group__krylov__methods.html#gae73aeb8fd04ee86a128240ac62c20e33">Conjugate-Residual(CR)</a></li>
<li><a href="group__krylov__methods.html#gad82e975fa15cb096d13507163325c2b5">Biconjugate Gradient (BiCG)</a></li>
<li><a href="group__krylov__methods.html#ga23cfa8325966505d6580151f91525887">Biconjugate Gradient Stabilized (BiCGstab)</a></li>
<li><a href="group__krylov__methods.html#ga691b2d4d03fd7b23e674f9f046691b46">Generalized Minimum Residual (GMRES)</a></li>
<li><a href="group__krylov__methods.html#gae25c1e3e77e92709bfa9f3726328e421">Multi-mass Conjugate-Gradient (CG-M)</a></li>
<li><a href="group__krylov__methods.html#gae9649279f0fb30cbc6a48c9f912a5f87">Multi-mass Biconjugate Gradient stabilized (BiCGstab-M)</a></li>
</ul>
<p>More detailed examples are available <a href="examples.html">here</a>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="hyb__matrix_8h.html">cusp/hyb_matrix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="monitor_8h.html">cusp/monitor.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="poisson_8h.html">cusp/gallery/poisson.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="cg_8h.html">cusp/krylov/cg.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// where to perform the computation</span></div>
<div class="line"><span class="keyword">typedef</span> cusp::device_memory MemorySpace;</div>
<div class="line"></div>
<div class="line"><span class="comment">// which floating point type to use</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">float</span> ValueType;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// create an empty sparse matrix structure (HYB format)</span></div>
<div class="line">    <a class="code" href="classcusp_1_1hyb__matrix.html">cusp::hyb_matrix&lt;int, ValueType, MemorySpace&gt;</a> A;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// create a 2d Poisson problem on a 10x10 mesh</span></div>
<div class="line">    <a class="code" href="group__gallery.html#ga4369f22c9caff12729026e5ce79ef281">cusp::gallery::poisson5pt</a>(A, 10, 10);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// allocate storage for solution (x) and right hand side (b)</span></div>
<div class="line">    <a class="code" href="classcusp_1_1array1d.html">cusp::array1d&lt;ValueType, MemorySpace&gt;</a> x(A.num_rows, 0);</div>
<div class="line">    <a class="code" href="classcusp_1_1array1d.html">cusp::array1d&lt;ValueType, MemorySpace&gt;</a> b(A.num_rows, 1);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// set stopping criteria:</span></div>
<div class="line">    <span class="comment">//  iteration_limit    = 100</span></div>
<div class="line">    <span class="comment">//  relative_tolerance = 1e-3</span></div>
<div class="line">    <a class="code" href="classcusp_1_1monitor.html">cusp::monitor&lt;ValueType&gt;</a> monitor(b, 100, 1e-3, 0, <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// set preconditioner (identity)</span></div>
<div class="line">    <a class="code" href="classcusp_1_1identity__operator.html">cusp::identity_operator&lt;ValueType, MemorySpace&gt;</a> M(A.num_rows, A.num_rows);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// solve the linear system A * x = b with the Conjugate Gradient method</span></div>
<div class="line">    <a class="code" href="group__krylov__methods.html#ga6aa97799b77e1de21fc88be236c6e4a8">cusp::krylov::cg</a>(A, x, b, monitor, M);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
</div><!-- fragment --><h2>Preconditioners</h2>
<p><a href="http://en.wikipedia.org/wiki/Preconditioner">Preconditioners</a> are a way to improve the <a href="http://en.wikipedia.org/wiki/Rate_of_convergence">rate of convergence</a> of iterative solvers. The good preconditioner is fast to compute and approximates the inverse of the matrix in some sense. Cusp provides the following preconditioners:</p>
<ul>
<li><a href="classcusp_1_1precond_1_1aggregation_1_1smoothed__aggregation.html">Algebraic Multigrid (AMG) based on Smoothed Aggregation</a></li>
<li><a href="classcusp_1_1precond_1_1bridson__ainv.html">Approximate Inverse(AINV)</a></li>
<li><a href="classcusp_1_1precond_1_1diagonal.html">Diagonal</a></li>
</ul>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="smoothed__aggregation_8h.html">cusp/precond/aggregation/smoothed_aggregation.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="cg_8h.html">cusp/krylov/cg.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="poisson_8h.html">cusp/gallery/poisson.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="csr__matrix_8h.html">cusp/csr_matrix.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Monitor&gt;</div>
<div class="line"><span class="keywordtype">void</span> report_status(Monitor&amp; monitor)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (monitor.converged())</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;  Solver converged to &quot;</span> &lt;&lt; monitor.tolerance() &lt;&lt; <span class="stringliteral">&quot; tolerance&quot;</span>;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot; after &quot;</span> &lt;&lt; monitor.iteration_count() &lt;&lt; <span class="stringliteral">&quot; iterations&quot;</span>;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; monitor.residual_norm() &lt;&lt; <span class="stringliteral">&quot; final residual)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;  Solver reached iteration limit &quot;</span> &lt;&lt; monitor.iteration_limit() &lt;&lt; <span class="stringliteral">&quot; before converging&quot;</span>;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; monitor.tolerance() &lt;&lt; <span class="stringliteral">&quot; tolerance &quot;</span>;</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; monitor.residual_norm() &lt;&lt; <span class="stringliteral">&quot; final residual)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">typedef</span> <span class="keywordtype">int</span>                 IndexType;</div>
<div class="line">    <span class="keyword">typedef</span> <span class="keywordtype">float</span>               ValueType;</div>
<div class="line">    <span class="keyword">typedef</span> cusp::device_memory MemorySpace;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// create an empty sparse matrix structure</span></div>
<div class="line">    <a class="code" href="classcusp_1_1coo__matrix.html">cusp::coo_matrix&lt;IndexType, ValueType, MemorySpace&gt;</a> A;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// create 2D Poisson problem</span></div>
<div class="line">    <a class="code" href="group__gallery.html#ga4369f22c9caff12729026e5ce79ef281">cusp::gallery::poisson5pt</a>(A, 256, 256);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classcusp_1_1array1d.html">cusp::array1d&lt;ValueType, MemorySpace&gt;</a> x0(A.num_rows, 0);</div>
<div class="line">    <a class="code" href="classcusp_1_1array1d.html">cusp::array1d&lt;ValueType, MemorySpace&gt;</a> b(A.num_rows, 1);</div>
<div class="line">    <a class="code" href="classcusp_1_1monitor.html">cusp::monitor&lt;ValueType&gt;</a> monitor(b, 1000, 1e-6);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// solve without preconditioning</span></div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;\nSolving with no preconditioner...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// allocate storage for solution (x) and right hand side (b)</span></div>
<div class="line">        <a class="code" href="classcusp_1_1array1d.html">cusp::array1d&lt;ValueType, MemorySpace&gt;</a> x(x0);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// solve</span></div>
<div class="line">        <a class="code" href="group__krylov__methods.html#ga6aa97799b77e1de21fc88be236c6e4a8">cusp::krylov::cg</a>(A, x, b, monitor);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// report status</span></div>
<div class="line">        monitor.print();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// solve with smoothed aggregation algebraic multigrid preconditioner</span></div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;\nSolving with smoothed aggregation preconditioner...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// allocate storage for solution (x) and right hand side (b)</span></div>
<div class="line">        <a class="code" href="classcusp_1_1array1d.html">cusp::array1d&lt;ValueType, MemorySpace&gt;</a> x(x0);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// reset the monitor</span></div>
<div class="line">        monitor.reset(b);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// setup preconditioner</span></div>
<div class="line">        <a class="code" href="classcusp_1_1precond_1_1aggregation_1_1smoothed__aggregation.html">cusp::precond::aggregation::smoothed_aggregation&lt;IndexType, ValueType, MemorySpace&gt;</a> M(A);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// solve</span></div>
<div class="line">        <a class="code" href="group__krylov__methods.html#ga6aa97799b77e1de21fc88be236c6e4a8">cusp::krylov::cg</a>(A, x, b, monitor, M);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// report status</span></div>
<div class="line">        monitor.print();</div>
<div class="line"></div>
<div class="line">        <span class="comment">// print hierarchy information</span></div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;\nPreconditioner statistics&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        M.print();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
</div><!-- fragment --><h2>User-Defined Linear Operators</h2>
<p>Sometimes it is useful to solve a linear system <code>A * x = b</code> without converting the matrix <code>A</code> into one of Cusp's formats. For this reason Cusp supports user-defined <a href="classcusp_1_1linear__operator.html">linear operators</a> that take in a vector <code>x</code> and compute the result <code>y = A * x</code>. These black-box operators can be used to interface <a href="http://en.wikipedia.org/wiki/Matrix-free_methods">matrix-free methods</a> with Cusp's iterative solvers.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="linear__operator_8h.html">cusp/linear_operator.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="cg_8h.html">cusp/krylov/cg.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// This example shows how to use cusp::linear_operator to solve</span></div>
<div class="line"><span class="comment">// a linear system with a user-defined linear operator A.  The</span></div>
<div class="line"><span class="comment">// linear_operator is a way to interface custom sparse matrix</span></div>
<div class="line"><span class="comment">// formats or so-called &quot;matrix-free&quot; methods with the iterative</span></div>
<div class="line"><span class="comment">// solvers in Cusp.  In this example, we illustrate a matrix-free</span></div>
<div class="line"><span class="comment">// implementation of a simple 5-point finite-difference stencil,</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//                [  0 -1  0 ]</span></div>
<div class="line"><span class="comment">//                [ -1  4 -1 ]</span></div>
<div class="line"><span class="comment">//                [  0 -1  0 ]</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// using a CUDA kernel.  We combine the linear_operator with the</span></div>
<div class="line"><span class="comment">// Conjugate Gradient method to solve a 2D Poisson problem.</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">__global__</div>
<div class="line"><span class="keywordtype">void</span> stencil_kernel(<span class="keywordtype">int</span> N, <span class="keyword">const</span> <span class="keywordtype">float</span> * x, <span class="keywordtype">float</span> * y)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// compute y = A*x, where A is the 5-point stencil</span></div>
<div class="line">    <span class="comment">// note: pre-caching a window of x into __shared__ memory</span></div>
<div class="line">    <span class="comment">// would make this a lot faster.</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> i = blockDim.x * blockIdx.x + threadIdx.x;</div>
<div class="line">    <span class="keywordtype">int</span> j = blockDim.y * blockIdx.y + threadIdx.y;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (i &lt; N &amp;&amp; j &lt; N)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// linear index into 2D grid</span></div>
<div class="line">        <span class="keywordtype">int</span> index = N * i + j;</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">float</span> result = 4.0f * x[index];         <span class="comment">// center point</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (i &gt; 0    ) result -= x[index - N];  <span class="comment">// lower neighbor</span></div>
<div class="line">        <span class="keywordflow">if</span> (i &lt; N - 1) result -= x[index + N];  <span class="comment">// upper neighbor</span></div>
<div class="line">        <span class="keywordflow">if</span> (j &gt; 0    ) result -= x[index - 1];  <span class="comment">// left neighbor</span></div>
<div class="line">        <span class="keywordflow">if</span> (j &lt; N - 1) result -= x[index + 1];  <span class="comment">// right neighbor</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// write result</span></div>
<div class="line">        y[N * i + j] = result;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>stencil : <span class="keyword">public</span> <a class="code" href="classcusp_1_1linear__operator.html">cusp::linear_operator</a>&lt;float,cusp::device_memory&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">typedef</span> <a class="code" href="classcusp_1_1linear__operator.html">cusp::linear_operator&lt;float,cusp::device_memory&gt;</a> super;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> N;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// constructor</span></div>
<div class="line">    stencil(<span class="keywordtype">int</span> N)</div>
<div class="line">        : super(N*N,N*N), N(N) {}</div>
<div class="line"></div>
<div class="line">    <span class="comment">// linear operator y = A*x</span></div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> VectorType1,</div>
<div class="line">             <span class="keyword">typename</span> VectorType2&gt;</div>
<div class="line">    <span class="keywordtype">void</span> operator()(<span class="keyword">const</span> VectorType1&amp; x, VectorType2&amp; y)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="comment">// obtain a raw pointer to device memory</span></div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">float</span> * x_ptr = thrust::raw_pointer_cast(&amp;x[0]);</div>
<div class="line">        <span class="keywordtype">float</span> * y_ptr = thrust::raw_pointer_cast(&amp;y[0]);</div>
<div class="line"></div>
<div class="line">        dim3 dimBlock(16,16);</div>
<div class="line">        dim3 dimGrid((N + 15) / 16, (N + 15) / 16);</div>
<div class="line"></div>
<div class="line">        stencil_kernel&lt;&lt;&lt;dimGrid,dimBlock&gt;&gt;&gt;(N, x_ptr, y_ptr);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// number of grid points in each dimension</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> N = 10;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// create a matrix-free linear operator</span></div>
<div class="line">    stencil A(N);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// allocate storage for solution (x) and right hand side (b)</span></div>
<div class="line">    <a class="code" href="classcusp_1_1array1d.html">cusp::array1d&lt;float, cusp::device_memory&gt;</a> x(A.num_rows, 0);</div>
<div class="line">    <a class="code" href="classcusp_1_1array1d.html">cusp::array1d&lt;float, cusp::device_memory&gt;</a> b(A.num_rows, 1);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// set stopping criteria:</span></div>
<div class="line">    <span class="comment">//  iteration_limit    = 100</span></div>
<div class="line">    <span class="comment">//  relative_tolerance = 1e-6</span></div>
<div class="line">    <a class="code" href="classcusp_1_1monitor.html">cusp::monitor&lt;float&gt;</a> monitor(b, 100, 1e-5, 0, <span class="keyword">false</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// solve the linear system A * x = b with the Conjugate Gradient method</span></div>
<div class="line">    <a class="code" href="group__krylov__methods.html#ga6aa97799b77e1de21fc88be236c6e4a8">cusp::krylov::cg</a>(A, x, b, monitor);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
</div><!-- fragment --><h2>Additional Resources</h2>
<p>This guide only scratches the surface of what you can do with Cusp. The following resources can help you learn to do more with Thrust or provide assistance when problems arise.</p>
<ul>
<li>Comprehensive <a href="modules.html">Documentation</a> of Cusp's API</li>
<li>A list of <a href="https://code.google.com/p/cusp-library/wiki/FrequentlyAskedQuestions">Frequently Asked Questions</a></li>
<li>Collection of <a href="examples.html">example</a> programs</li>
</ul>
<p>We strongly encourage users to subscribe to the <a href="http://groups.google.com/group/cusp-users">cusp-users</a> mailing list. The mailing list is a great place to seek out help from the Cusp developers and other Cusp users. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated for CUSP by <a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
<br>
&copy; 2014 NVIDIA Corporation
</small></address>
</body>
</html>
